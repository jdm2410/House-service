<app-admin-header></app-admin-header>
<div *ngIf="user$ | async as user" class="bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto">
    <!-- User Details -->
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">{{ user.surname }}</h2>
    <p class="text-gray-700 mb-2"><strong>Username:</strong> {{ user.username }}</p>
    <p class="text-gray-700 mb-2"><strong>Name:</strong> {{ user.name }}</p>
    <p class="text-gray-700 mb-2"><strong>Surname:</strong> {{ user.surname }}</p>
    <p class="text-gray-700 mb-2"><strong>Email:</strong> {{ user.email }}</p>
    <p class="text-gray-700 mb-4"><strong>Bio:</strong> {{ user.bio }}</p>

    <!-- Edit User Button -->
    <button *ngIf="!isEditMode" (click)="editUser()" class="px-4 py-2 bg-blue-600 text-white rounded-md">
        Edit User
    </button>

    <!-- User Edit Form -->
    <div *ngIf="isEditMode" class="bg-gray-100 p-6 rounded-lg shadow-md mt-6">
        <h3 class="text-lg font-semibold mb-4">Edit User</h3>
        <form [formGroup]="userForm" (ngSubmit)="updateUser()">
            <div class="mb-4">
                <label for="username" class="block text-gray-700 font-semibold">Username</label>
                <input type="text" id="username" formControlName="username" class="w-full mt-2 p-2 border rounded-md" />
            </div>

            <div class="mb-4">
                <label for="name" class="block text-gray-700 font-semibold">Name</label>
                <input type="text" id="name" formControlName="name" class="w-full mt-2 p-2 border rounded-md" />
            </div>

            <div class="mb-4">
                <label for="surname" class="block text-gray-700 font-semibold">Surname</label>
                <input type="text" id="surname" formControlName="surname" class="w-full mt-2 p-2 border rounded-md" />
            </div>

            <div class="mb-4">
                <label for="email" class="block text-gray-700 font-semibold">Email</label>
                <input type="email" id="email" formControlName="email" class="w-full mt-2 p-2 border rounded-md" />
            </div>

            <div class="mb-4">
                <label for="bio" class="block text-gray-700 font-semibold">Bio</label>
                <textarea id="bio" formControlName="bio" class="w-full mt-2 p-2 border rounded-md"></textarea>
            </div>

            <button type="submit" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-md">
                Update User
            </button>
            <button (click)="loadUser()" type="button" class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-md">
                Cancel
            </button>
        </form>
    </div>

    <!-- Tickets Section -->
    <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-4">Tickets</h3>

    <div *ngIf="tickets.length > 0" class="space-y-4">
        <ul class="space-y-4">
            <li *ngFor="let ticket of tickets"
                [ngClass]="{'bg-blue-50 border-blue-300': editingTicketId === ticket.id, 'bg-gray-50': editingTicketId !== ticket.id}"
                class="p-4 rounded-lg shadow-sm border">
                <p class="text-lg font-medium text-gray-900 mb-1">
                    <strong>{{ ticket.name }}</strong>
                    <span class="text-sm text-gray-500">({{ ticket.startDate | date }} - {{ ticket.endDate | date
                        }})</span>
                </p>
                <p class="text-gray-700">{{ ticket.description }}</p>
                <div class="flex space-x-2 mt-2">
                    <button *ngIf="editingTicketId !== ticket.id" (click)="editTicket(ticket)"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md">
                        Edit
                    </button>
                    <button *ngIf="ticket.id" (click)="deleteTicket(ticket.id)"
                        class="px-4 py-2 bg-red-600 text-white rounded-md">
                        Delete
                    </button>
                </div>
            </li>
        </ul>
    </div>

    <div *ngIf="tickets.length === 0" class="bg-yellow-100 p-4 rounded-lg shadow-sm mt-4">
        <p class="text-yellow-700">No tickets found for this user.</p>
    </div>

    <!-- Ticket Form -->
    <div class="bg-gray-100 p-6 rounded-lg shadow-md mt-6">
        <h3 class="text-lg font-semibold mb-4">{{ editingTicketId ? 'Edit Ticket' : 'Add Ticket' }}</h3>
        <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
            <div class="mb-4">
                <label for="name" class="block text-gray-700 font-semibold">Ticket Name</label>
                <input type="text" id="name" formControlName="name" class="w-full mt-2 p-2 border rounded-md" />
            </div>

            <div class="mb-4">
                <label for="category" class="block text-gray-700 font-semibold">Category</label>
                <select id="category" formControlName="category" class="w-full mt-2 p-2 border rounded-md">
                    <option value="Kitchen">Kitchen</option>
                    <option value="Garden">Garden</option>
                    <option value="Bedroom">Bedroom</option>
                    <option value="Plumbing">Plumbing</option>
                    <option value="Painting">Painting</option>
                    <option value="Woodwork">Woodwork</option>
                    <option value="Electricity">Electricity</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="description" class="block text-gray-700 font-semibold">Description</label>
                <textarea id="description" formControlName="description"
                    class="w-full mt-2 p-2 border rounded-md"></textarea>
            </div>

            <div class="mb-4">
                <label for="startDate" class="block text-gray-700 font-semibold">Start Date</label>
                <input type="date" id="startDate" formControlName="startDate"
                    class="w-full mt-2 p-2 border rounded-md" />
                <div *ngIf="ticketForm.get('startDate')?.errors?.['startDateInvalid']" class="text-red-500 mt-1">
                    Start date cannot be in the past.
                </div>
            </div>

            <div class="mb-4">
                <label for="endDate" class="block text-gray-700 font-semibold">End Date</label>
                <input type="date" id="endDate" formControlName="endDate" class="w-full mt-2 p-2 border rounded-md" />
                <div *ngIf="ticketForm.hasError('endDateInvalid')" class="text-red-500 mt-1">
                    End date must be at least one day after the start date.
                </div>
            </div>

            <button type="submit" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-md">
                {{ editingTicketId ? 'Update Ticket' : 'Create Ticket' }}
            </button>

            <!-- Optional: Cancel button to reset form -->
            <button *ngIf="editingTicketId" (click)="cancelEdit()" type="button"
                class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-md">
                Cancel
            </button>
        </form>
    </div>

    <!-- Requests Section -->
    <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-4">Requests</h3>

    <div *ngIf="requests.length > 0" class="space-y-4">
        <ul class="space-y-4">
            <li *ngFor="let request of requests"
                [ngClass]="{'bg-blue-50 border-blue-300': editingRequestId === request.id, 'bg-gray-50': editingRequestId !== request.id}"
                class="p-4 rounded-lg shadow-sm border">
                <p class="text-lg font-medium text-gray-900 mb-1">
                    <strong>{{ request.serviceName }}</strong>
                    <span class="text-sm text-gray-500">({{ request.startDate | date }})</span>
                </p>
                <p class="text-gray-700">{{ request.requestText }}</p>
                <div class="flex space-x-2 mt-2">
                    <button *ngIf="request.id" class="px-4 py-2 bg-red-600 text-white rounded-md">
                        Delete
                    </button>
                </div>
            </li>
        </ul>
    </div>

    <div *ngIf="requests.length === 0" class="bg-yellow-100 p-4 rounded-lg shadow-sm mt-4">
        <p class="text-yellow-700">No requests found for this user.</p>
    </div>
</div>